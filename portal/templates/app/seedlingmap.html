{% extends 'update/base.html' %}
{% block seedmap %} active {% endblock %}
{% block smonitor %} menu-open {% endblock %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
<link rel="stylesheet" href="/static/dist/css/map.css">
<link rel="stylesheet" href="/static/app/css/leaflet-measure.css" />
<style type="text/css">
#map {
    height: calc(100vh - 57px) !important;
    overflow: hidden;
    position: relative;
    width: calc(100% - 265px);
    /*width: 100%;*/
    /*z-index: 9999999999999999999999999;*/
}

.text-color {
    color: #298541;
}

.berrybox {
    background-color: #fff;
    border-radius: 8px;
}

.popbox {
    position: absolute;
    left: 0;
    right: 0;
    margin-left: auto;
    margin-right: auto;
    width: 500px;
    /* Need a specific value to work */
    min-height: 20vh;
    top: 25vh;
}

.legendbox {
    position: absolute;
    left: 0;
    width: 200px;
    min-height: 20vh;
    bottom: 2vh;
}

span.close {
    float: right;
    padding: 5px 7px;
    border-radius: 100%;
    border: 1px solid red;
    color: red;
    font-size: 12px;
}

.berrybox_head {
    padding: 10px 10px 5px 20px;
}

.berrybox_body {
    min-height: 15vh;
    padding: 10px;
}

.berrybox_footer {
    padding: 10px;
}

.btn-berry {
    border-radius: 15px;
    background: #298541;
    color: #fff;
    padding: 5px 10px;
}

.btn-nobg {
    border: 1px solid #298541;
    background: transparent;
    color: #298541;
    ;
}

.custom-control-input:checked~.custom-control-label::before {
    color: #fff!important;
    background-color: #358542!important;
}

.leaflet-popup-content-wrapper{
    width: 25vw!important;
}

</style>
{% endblock%}
{% block body %}
<div class="content-wrapper" id="map">
    <div class="">
        <div class="mapLegend" id="mapLegend">
            <div id="" class="toolBar bgWhite">
                <img id="legBox" src="/static/dist/img/maptools/Legend.svg" class="toolbaricon" title="Toggle Legend" data-container="body" data-toggle="popover" data-placement="left" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">
                <img id="baseMap" src="/static/dist/img/maptools/Basemap.svg" class="toolbaricon" title="Toggle Basemap">
                <img id="reload" src="/static/dist/img/maptools/Refresh.svg" class="toolbaricon" title="toggle Duration">
                <img id="" src="/static/dist/img/maptools/Print.svg" class="toolbaricon" title="print map">
            </div>
            <div class="legendCont" id="lgd" style="display: block;">
                <div class="baseMap_Cont">
                    <div class="accordion">
                        <div class="option"> <input type="checkbox" id="toggle1" class="toggle"> <label class="title" for="toggle1"> Admin Boundaries </label>
                            <div class="content" style="overflow-y:auto;height:100px;"><i class="entypo-down-open-big sf"></i>
                                <ul class="submenu">
                                    <li>
                                        <!-- <div class="togglebutton m-b-5 ">
                                            <label>
                                                <input id="distcheck" type="checkbox" class="toggle-success ledgcheck"><span class="toggle"></span> District
                                            </label>
                                        </div> -->

                                            <div class="custom-control custom-switch">
                                              <input type="checkbox" class="custom-control-input" id="distcheck">
                                              <label style="font-size: 16px!important;font-weight: 300!important;" class="custom-control-label" for="distcheck"> District</label>
                                            </div>


                                        
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="option"> <input type="checkbox" id="toggledis" class="toggle"> <label class="title" for="toggledis">Layers</label>
                            <div class="content" style="overflow-y:auto;height:250px;"><i class="entypo-down-open-big sf"></i>
                                <ul class="submenu">
                                    <li>
                                        
                                       <div class="custom-control custom-switch">
                                          <input type="checkbox" class="custom-control-input" id="farmcheck">
                                          <label style="font-size: 16px!important;font-weight: 300!important;" class="custom-control-label" for="farmcheck"> Farm Lands</label>
                                        </div>
                                        <hr>
                                    </li>
                                    <li>
                                       <!--  <div class="togglebutton m-b-5 ">
                                            <label>
                                                <input id="treeloadcheck" type="checkbox" class="toggle-success ledgcheck"><span class="toggle"></span> Trees
                                            </label>
                                        </div>
 -->
                                         <div class="custom-control custom-switch">
                                          <input type="checkbox" class="custom-control-input" id="treeloadcheck">
                                          <label style="font-size: 16px!important;font-weight: 300!important;" class="custom-control-label" for="treeloadcheck"> Trees</label>
                                        </div>


                                      <!--   <hr> -->
                                    </li>

                                     <li>
                                       <!--  <div class="togglebutton m-b-5 ">
                                            <label>
                                                <input id="treeloadcheck" type="checkbox" class="toggle-success ledgcheck"><span class="toggle"></span> Trees
                                            </label>
                                        </div>
 -->
                                      <!--    <div class="custom-control custom-switch">
                                          <input type="checkbox" class="custom-control-input" id="biomascheck">
                                          <label style="font-size: 16px!important;font-weight: 300!important;" class="custom-control-label" for="biomascheck"> Biomas</label>
                                        </div> -->

                                        
                                        <!-- <hr> -->
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="legendCont bgWhite" id="bsmp">
                <div class="baseMap_Cont">
                    <div class="tileDiv" id="no_basemap" style="">
                        <img src="/static/dist/img/tiles/1.png" class="tiles" title="Satellite Image">
                        No Basemap
                    </div>
                    <div class="tileDiv" id="basemap1" style="">
                        <img id="" src="/static/dist/img/tiles/2.png" class="tiles" title="Satellite Image">
                        Openstreetmap
                    </div>
                    <div class="tileDiv" id="basemap2" style="">
                        <img id="" src="/static/dist/img/tiles/3.png" class="tiles" title="Satellite Image">
                        Satellite Image
                    </div>
                    <div class="tileDiv" id="basemap3" style="">
                        <img id="" src="/static/dist/img/tiles/4.png" class="tiles" title="Satellite Image">
                        Openstreetmap Hotmap
                    </div>
                    <div class="tileDiv" id="basemap4" style="">
                        <img id="" src="/static/dist/img/tiles/5.png" class="tiles" title="Satellite Image">
                        Opentopomap
                    </div>
                    <div class="tileDiv" id="basemap6" style="">
                        <img id="" src="/static/dist/img/tiles/6.png" class="tiles" title="Satellite Image">
                        World Street Map
                    </div>
                </div>
            </div>
        </div>
        <!--   <div class="berrybox popbox">
            <div class="berrybox_head text-color">
                <h5>
                    Heading Text
                    <span class="close"> X </span>
                </h5>
            </div>
            <div class="berrybox_body">
                <p> TEXT BODY HERE</p>
            </div>
            <div class="berrybox_footer">
                <a class="btn btn-berry" href=""> Select</a>
                <a class="btn btn-berry btn-nobg" href=""> Cancel</a>
            </div>
        </div> -->
        <!-- <div class="berrybox legendbox">
            <div class="berrybox_head text-color">
                <h5>
                    Legend
                    <span class="close"> X </span>
                </h5>
            </div>
            <div class="berrybox_body">
                <div class="row" style="padding:0px 20px;">
                    <label>
                        <div class=" sectordiv mydivicon16"></div><img class="proj" src="/static/mapApp/img/legend/odfstatus/100.png"><span> Legend Text </span>
                    </label> <br>
                    <label>
                        <div class=" sectordiv mydivicon16"></div><img class="proj" src="/static/mapApp/img/legend/odfstatus/100.png"><span> Legend Text </span>
                    </label> <br>
                    <label>
                        <div class=" sectordiv mydivicon16"></div><img class="proj" src="/static/mapApp/img/legend/odfstatus/100.png"><span> Legend Text </span>
                    </label> <br>
                    <label>
                        <div class=" sectordiv mydivicon16"></div><img class="proj" src="/static/mapApp/img/legend/odfstatus/100.png"><span> Legend Text </span>
                    </label> <br>
                    <label>
                        <div class=" sectordiv mydivicon16"></div><img class="proj" src="/static/mapApp/img/legend/odfstatus/100.png"><span> Legend Text </span>
                    </label>
                </div>
            </div>
        </div> -->
    </div>
</div>
{% endblock %}
{% block js %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
<script src="/static/app/js/leaflet-measure.js"></script>
<script src="https://unpkg.com/geojson-vt@3.2.0/geojson-vt.js"></script>
<script src="/static/dist/js/leaflet-geojson-vt.js"></script>
<script src="/static/dist/js/mapseedling.js"></script>
<script type="text/javascript">
var farm, farmmap,farmmaps
var trees


{% if code %}





$("#treeloadcheck")

$.get("/gettrees/{{code}}/", function(data) {

    tree = L.geoJSON(data, {
            pointToLayer: function(feature, latlng) {
                baseballIcon = L.icon({iconUrl:'/static/app/img/tree.png' ,iconSize: [30,20]});
                 return L.marker(latlng, {icon: baseballIcon});
                // return L.circleMarker(latlng, style);
            },
            onEachFeature: onEachtreepoints
        });


        $('#treeloadcheck').prop('checked', true);

    // var options = {
    //     maxZoom: 20,
    //     tolerance: 3,
    //     debug: 0,
    //     style: {
    //         fillColor: "#1EB300",
    //         color: "#F2FF00",
    //     },
    //     pointToLayer: function(feature, latlng) {
    //         baseballIcon = L.icon({ iconUrl: '/static/app/img/tree.png', iconSize: [30, 20] });
    //         return L.marker(latlng, { icon: baseballIcon });
    //         // return L.circleMarker(latlng, style);
    //     },
    //     onEachFeature: onEachtreepoints
    // };
    // trees = L.geoJson.vt(data, options).addTo(map);




    mymap.addLayer(tree)

    // mymap.fitBounds(geodata.getBounds())

})



$.get("/farmboundarylayer/?code={{code}}", function(data) {
    farmmap = L.geoJSON(data, {style: newfarm, onEachFeature: farm_onEachFeature}).addTo(mymap)
    // farmmap = L.geoJSON(data)
    $('#farmcheck').prop('checked', true);
    mymap.addLayer(farmmap)
    mymap.fitBounds(farmmap.getBounds())

})




{% else %}




$.get("/api/surveys/boundaries/", function(data) {

    farmmap = L.geoJSON(data, {style: newfarm, onEachFeature: farm_onEachFeature}).addTo(mymap);

    // farmmap = L.geoJSON(data).addTo(mymap);;



    $('#farmcheck').prop('checked', true);



})


// farmMap('/farmboundarylayer/', newfarm, farm_onEachFeature,farmmap)

$.get("/gettrees/",function(data){

    tree = L.geoJSON(data, {
            pointToLayer: function(feature, latlng) {
                // baseballIcon = L.icon({iconUrl:'/static/app/img/tree.png' ,iconSize: [40,20]});
                //  return L.marker(latlng, {icon: baseballIcon});
                return L.circleMarker(latlng,geojsonMarkerOptions);

            },
            onEachFeature: onEachtreepoints

        });


    // mymap.addLayer(tree)

     $("#treeload").hide()

   $(".overlay1").hide()

})



{% endif %}





function getColor(d) {


    {% for aa in ledgend %}

    if (d <= {{ aa.to }} && d > {{ aa.from }}) {

        return "{{ aa.color }}"

    }


    {% endfor %}

}


function style(feature) {
    return {
        fillColor: getColor(feature.properties.biomas),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

function biomas() {
    return {
        fillColor: 'transparent',
        color: 'red',
        weight: '3',
        dashArray: '',
        opacity: '1',
        fillOpacity: '0',
    };
}




function biomasonEachFeature(feature, layer) {


    labeltoshow = '<table class="table table-bordered">'
    labeltoshow += "<thead><tr style='background-color:#4aa;color:white;'><th colspan='2' > <b><center> " + feature.properties.community + "</center></b></th><tr></thead>"

    // labeltoshow += "<tbody><tr><td> <b> Community </b></td><td> " + feature.properties.community + " </td></tr>"
    labeltoshow += "<tbody><tr><td> <b> Biomas </b></td><td> " + feature.properties.biomas + " </td></tr>"

    labeltoshow += "</tbody></table>"

    //  layer.bindPopup(labeltoshow, {
    //     direction: 'auto'
    // })

    layer.bindTooltip(labeltoshow, {
        direction: 'auto'
    })

}

// $("#ledgend").hide()
var biomaslayer
// biomasmap('/biomasmap/', style, biomasonEachFeature)


    // $.get('/biomasmap/', function(data) {
    //     biomaslayer = new L.GeoJSON(data, {
    //         style: style,
    //         onEachFeature: biomasonEachFeature
    //     })

    //     $("#biomasload").hide()
    // })


$('#biomascheck').on('change', function() {
    var man = $('#biomascheck').is(':checked');

    if (man == true) {
        if (biomaslayer) {
            mymap.addLayer(biomaslayer);
            $("#ledgend").show()
        }
    } else {
        mymap.removeLayer(biomaslayer);
        $("#ledgend").hide()
    }
})
</script>
{% endblock%}